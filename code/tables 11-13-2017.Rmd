---
title: "Dan Meeting 11-14-2017"
author: "Alan Ritchie"
date: "November 13, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r setup, include=FALSE}}
library(tidyverse)
library(ggplot2)
#upload seed data
seed_land<-read.csv("data/seed_land.csv")

```
Response Variable Tables 


Total Seeds X Fruit

```{r}
seed_tbl<-summarise(seed_land,n_fruit=n(),avg=mean(total.seeds),median=median(total.seeds), 
                    sd=sd(total.seeds), var=var(total.seeds),coef_var=sd/avg)
seed_tbl
```


Pollinated Ovules /  Fruit
```{r}
pollov_tbl<-summarise(seed_land,n_fruit=n(),avg=mean(poll_ovules),median=median(poll_ovules), 
          sd=sd(poll_ovules), var=var(poll_ovules), coef_var=sd/avg) # table of mean, median, variance in poll_ovules
pollov_tbl
```

Pollinated Ovules/Total Ovules / Fruit
```{r}
pollratio_tbl<-summarise(seed_land,fruit_count=n(), avg_pol=mean(poll_ovules/total.ovules), med_pol=median(poll_ovules/total.ovules),
            var_pol=var(poll_ovules/total.ovules), sd_pol=sd(poll_ovules/total.ovules), 
            coef_var_pol=(sd_pol/avg_pol))

pollratio_tbl
```


Pollen Limitation (Total Ovules - Pollinated Ovules) / Fruit

```{r}
pl_tbl<-summarise(seed_land,n_fruit=n(), avg=mean(poll_lim),median=median(poll_lim), 
                        sd=sd(poll_lim), var=var(poll_lim),coef_var=sd/avg)
pl_tbl


```


Site Response Variable Tables


Total Seeds / Site

Seeds collected per site

```{r}
seed_site_total<- seed_land %>%
  group_by(site) %>%
  summarise(fruit_count = n(), seeds=sum(total.seeds),avg_seeds=mean(total.seeds), med_seeds=median(total.seeds),
             sd_seeds=sd(total.seeds), var_seeds=var(total.seeds))
seed_site_total
### seeds collected by site, round, and treatment
seed_site<- seed_land %>%
  group_by(site,prop.c,round,trmnt) %>%
  summarise(fruit_count = n(), seeds=sum(total.seeds),avg_seeds=mean(total.seeds), med_seeds=median(total.seeds),
             sd_seeds=sd(total.seeds), var_seeds=var(total.seeds))

seed_site

```

Pollen Limitation / Site Table + Scatter plots

Degree of pollen limitation per fruit at the site level
```{r}
### Pollen Limitation by site and round
pl_site<- seed_land %>%
  group_by(site,prop.c) %>%
  summarise(fruit_count = n(), avg_pl=mean(poll_lim), med_pl=median(poll_lim),
            var_pl=var(poll_lim), sd_pl=sd(poll_lim), coef_var_pl=(sd_pl/avg_pl))

#ggplot(pl/site, aes(reorder(site,prop.c), avg_pl)) + geom_violin(draw_quantiles=.5) +ggtitle("avgPL by Site")
ggplot(pl_site, aes(prop.c,avg_pl)) +geom_point(aes(color=site)) +ggtitle("Avg PL by % Development")
ggplot(pl_site, aes(prop.c,med_pl)) +geom_point(aes(color=site)) +ggtitle("Med PL by % Development")
ggplot(pl_site, aes(prop.c,var_pl)) +geom_point(aes(color=site)) +ggtitle("Variance in PL by % Development")
ggplot(pl_site, aes(prop.c,coef_var_pl)) +geom_point(aes(color=site)) +ggtitle("CV of PL by % Development")


```

Pollinated Ovules / Site Table

Number Ovules pollinated in a fruit at the site level
```{r}
####
pol_ov_site<- seed_land %>%
  group_by(site,prop.c) %>%
  summarise(fruit_count = n(), avg_pol=mean(poll_ovules), med_pol=median(poll_ovules),
            var_pol=var(poll_ovules), sd_pol=sd(poll_ovules), coef_var_pol=(sd_pol/avg_pol))


ggplot(pol_ov_site, aes(prop.c,avg_pol)) +geom_point(aes(color=site)) +ggtitle("Avg Pol Ov by % Development")
ggplot(pol_ov_site, aes(prop.c,med_pol)) +geom_point(aes(color=site)) +ggtitle("Med Poll Ov by % Development")
ggplot(pol_ov_site, aes(prop.c,var_pol)) +geom_point(aes(color=site)) +ggtitle("Variance in Pol Ov by % Development")
ggplot(pol_ov_site, aes(prop.c,coef_var_pol)) +geom_point(aes(color=site)) +ggtitle("CV of Pol Ov by % Development")

```
Pollinated Ovule/Virgin Ovules / Site & % Developed

The proportion of available ovules pollinated in a fruit at the site level
```{r}

pol_ratio_site<- seed_land %>%
  group_by(site,prop.c) %>%
  summarise(fruit_count=n(), avg_pol=mean(poll_ovules/total.ovules), med_pol=median(poll_ovules/total.ovules),
            var_pol=var(poll_ovules/total.ovules), sd_pol=sd(poll_ovules/total.ovules), 
            coef_var_pol=(sd_pol/avg_pol))
  

          
 ggplot(pol_ratio_site , aes(prop.c,avg_pol)) +geom_point(aes(color=site))  +ggtitle("Avg Pol Ratio by % Development")
 
ggplot(pol_ratio_site, aes(prop.c,med_pol)) +geom_point(aes(color=site)) +ggtitle("Med Poll Ov Ratio by % Development")

ggplot(pol_ratio_site, aes(prop.c,var_pol)) +geom_point(aes(color=site)) +ggtitle("Variance in Pol Ov Ratio by % Development")

ggplot(pol_ratio_site, aes(prop.c,coef_var_pol)) +geom_point(aes(color=site)) +ggtitle("CV of Pol Ov Ratio by % Development")           
            
```

Pollinated Ovule/Virgin Ovules per treatment / Site & % Developed

The proportion of available ovules pollinated per treatment at the site level

```{r}

pol_ratiotrmnt_site<- seed_land %>%
  group_by(site,prop.c,trmnt) %>%
  summarise(fruit_count=n(), avg_pol=mean(poll_ovules/total.ovules), med_pol=median(poll_ovules/total.ovules),
            var_pol=var(poll_ovules/total.ovules), sd_pol=sd(poll_ovules/total.ovules), 
            coef_var_pol=(sd_pol/avg_pol))
  

          
 ggplot(pol_ratiotrmnt_site , aes(prop.c,avg_pol)) +geom_point(aes(color=site, shape=trmnt))  +ggtitle("Avg Pol Ratio by % Development")
 
ggplot(pol_ratiotrmnt_site, aes(prop.c,med_pol)) +geom_point(aes(color=site,shape=trmnt)) +ggtitle("Med Poll Ov Ratio by % Development")

ggplot(pol_ratiotrmnt_site, aes(prop.c,var_pol)) +geom_point(aes(color=site,shape=trmnt)) +ggtitle("Variance in Pol Ov Ratio by % Development")

ggplot(pol_ratiotrmnt_site, aes(prop.c,coef_var_pol)) +geom_point(aes(color=site, shape=trmnt)) +ggtitle("CV of Pol Ov Ratio by % Development")           
            
```



Plant Level Response Variables

Total seeds collected / plant

```{r}
seed_plant<- seed_land %>%
  group_by(prop.c,site,ID, trmnt)%>%
  summarise(fruit_count=n(),seed_total=sum(total.seeds), avg_seeds=mean(total.seeds), med_seeds=median(total.seeds), 
            var_seeds=var(total.seeds), sd_seeds=sd(total.seeds), CV_seeds=sd_seeds/avg_seeds)

ggplot(seed_plant,aes(trmnt,avg_seeds))+geom_violin(draw_quantiles=.5)
ggplot(seed_plant,aes(trmnt,med_seeds))+geom_violin(draw_quantiles=.5)

ggplot(seed_plant,aes(prop.c,med_seeds))+geom_jitter(aes(color=site))
ggplot(seed_plant,aes(prop.c,avg_seeds))+geom_jitter(aes(color=site))
ggplot(seed_plant,aes(prop.c,var_seeds))+geom_jitter(aes(color=site))
ggplot(seed_plant,aes(prop.c,CV_seeds))+geom_jitter(aes(color=site))

```

Pollinated Ovules / Plant table

```{r}
### Pollinated ovules x plant table
pollov_plant<-seed_land %>%
  group_by(site,round, prop.c,ID,trmnt)%>%
  summarise(fruit_count=n(), avg_pol=mean(poll_ovules), med_pol=median(poll_ovules),
            var_pol=var(poll_ovules), sd_pol=sd(poll_ovules), cv_pol=(sd_pol/avg_pol))

ggplot(pollov_plant, aes(trmnt,med_pol)) +geom_violin(draw_quantiles=.5) +ggtitle("Plant lvl Avg of Pol Ovs by treatment")

ggplot(pollov_plant, aes(trmnt,med_pol)) +geom_violin(draw_quantiles=.5) +ggtitle("Plant lvl median of Pol Ovs by treatment")

ggplot(pollov_plant, aes(trmnt,var_pol)) +geom_violin(draw_quantiles=.5) +ggtitle("Var Estimate of Pol Ovs by treatment")
ggplot(pollov_plant, aes(trmnt,cv_pol)) +geom_violin(draw_quantiles=.5) +ggtitle("Cv of Pol Ovs by treatment")

ggplot(pollov_plant, aes(prop.c,avg_pol)) +geom_jitter(aes(color=site)) 
ggplot(pollov_plant, aes(prop.c,med_pol)) +geom_jitter(aes(color=site)) 

ggplot(pollov_plant, aes(prop.c,var_pol)) +geom_jitter(aes(color=site)) 

ggplot(pollov_plant, aes(prop.c,cv_pol)) +geom_jitter(aes(color=site))
```

 Pollinated Ovule Ratio / Plant table
```{r}
pol_ratio_plant<-seed_land %>%
  group_by(site,round, prop.c, ID,trmnt)%>% 
  summarise(fruit_count=n(), avg_pol=mean(poll_ovules/total.ovules), med_pol=median(poll_ovules/total.ovules),
            var_pol=var(poll_ovules/total.ovules), sd_pol=sd(poll_ovules/total.ovules), 
            coef_var_pol=sd_pol/avg_pol)

ggplot(pol_ratio_plant, aes(trmnt,avg_pol)) +geom_violin(draw_quantiles=.5)+
ggtitle(" Mean Ratio of Pollinated Ovules per Treatment")

ggplot(pol_ratio_plant, aes(trmnt,avg_pol)) +geom_violin(draw_quantiles=.5)+
ggtitle(" Median Ratio of Pollinated Ovules per Treatment")

ggplot(pol_ratio_plant, aes(trmnt,avg_pol)) +geom_violin(draw_quantiles=.5)+
ggtitle(" Var of Ratio of Pollinated Ovules per Treatment")

ggplot(pol_ratio_plant, aes(trmnt,avg_pol)) +geom_violin(draw_quantiles=.5)+
ggtitle(" CV of Ratio of Pollinated Ovules per Treatment")

ggplot(pol_ratio_plant, aes(prop.c,avg_pol)) +geom_jitter(aes(color=site))+
  ggtitle("Change in Mean Ratio of Pollinated Ovule with % Developed")
ggplot(pol_ratio_plant, aes(prop.c,med_pol)) +geom_jitter(aes(color=site))+
  ggtitle("Change in Median Ratio of Pollinated Ovule with % Developed")
ggplot(pol_ratio_plant, aes(prop.c,var_pol)) +geom_jitter(aes(color=site))+
  ggtitle("Change in Ratio of Pollinated Ovule Variance with % Developed")
ggplot(pol_ratio_plant, aes(prop.c,coef_var_pol)) +geom_jitter(aes(color=site)) +
ggtitle("Change in Ratio of Pollinated Ovule CV with % Developed")
```


Pollen Limitation / Plant table

```{r}
pl_plant<-seed_land%>%
  group_by(site,round, prop.c,ID,trmnt)%>%
  summarise(frt_coll=n(),trtd_flwrs=sum(unique(flowers)),frt_flw_ratio= frt_coll/trtd_flwrs,
            avg_pl=mean(poll_lim), med_pl=median(poll_lim),
             sd_pl=sd(poll_lim), var_pl=var(poll_lim), cv_pl=(sd_pl/avg_pl))

pl_plant%>%
ggplot( aes(trmnt,avg_pl)) +geom_violin(draw_quantiles=.5)+
ggtitle(" Mean Pollen Limitation per Treatment")

pl_plant%>%
ggplot(aes(trmnt,med_pl)) +geom_violin(draw_quantiles=.5)+
ggtitle(" Median Pollen Limitation per Treatment")

pl_plant%>%
ggplot( aes(trmnt,var_pl)) +geom_violin(draw_quantiles=.5)+
ggtitle(" Var of Pollen Limitation per Treatment")

pl_plant%>%
ggplot( aes(trmnt,cv_pl)) +geom_violin(draw_quantiles=.5)+
ggtitle(" CV of Pollen Limitation per Treatment")
pl_plant%>%
ggplot( aes(prop.c,avg_pl)) +geom_jitter(aes(color=site))+
  ggtitle("Change in Mean PL with % Developed")

pl_plant%>%
ggplot( aes(prop.c,med_pl)) +geom_jitter(aes(color=site))+
  ggtitle("Change in Median PL with % Developed")

pl_plant%>%
ggplot( aes(prop.c,var_pl)) +geom_jitter(aes(color=site))+
  ggtitle("Change in PL Variance with % Developed")

pl_plant%>%
ggplot(aes(prop.c,cv_pl)) +geom_jitter(aes(color=site)) +
ggtitle("Change in PL CV with % Developed")



```